<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kios Handini - Sistem Manajemen Barang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .animate-fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen gradient-bg flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl card-shadow p-8 w-full max-w-md animate-fade-in">
            <div class="text-center mb-8">
                <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-store text-blue-600 text-2xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">Kios Handini</h1>
                <p class="text-gray-600 mt-2">Log In</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                    <div class="relative">
                        <i class="fas fa-user absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="username" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan username" required>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <div class="relative">
                        <i class="fas fa-lock absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="password" id="password" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan password" required>
                    </div>
                </div>
                
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 rounded-lg transition duration-200 transform hover:scale-105">
                    <i class="fas fa-sign-in-alt mr-2"></i>Masuk
                </button>
            </form>
            
            
            
            
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <div class="bg-blue-100 w-10 h-10 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-store text-blue-600"></i>
                        </div>
                        <h1 class="text-xl font-bold text-gray-800">Kios Handini</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600">Selamat datang, Admin</span>
                        <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm transition duration-200">
                            <i class="fas fa-sign-out-alt mr-1"></i>Keluar
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="bg-blue-100 w-12 h-12 rounded-lg flex items-center justify-center">
                            <i class="fas fa-boxes text-blue-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Total Barang</p>
                            <p id="totalItems" class="text-2xl font-bold text-gray-800">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="bg-green-100 w-12 h-12 rounded-lg flex items-center justify-center">
                            <i class="fas fa-check-circle text-green-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Stok Tersedia</p>
                            <p id="availableStock" class="text-2xl font-bold text-gray-800">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="bg-yellow-100 w-12 h-12 rounded-lg flex items-center justify-center">
                            <i class="fas fa-exclamation-triangle text-yellow-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Stok Menipis</p>
                            <p id="lowStock" class="text-2xl font-bold text-gray-800">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Bar -->
            <div class="bg-white rounded-xl card-shadow p-6 mb-8">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0">
                    <h2 class="text-xl font-bold text-gray-800">Manajemen Barang</h2>
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 w-full sm:w-auto">
                        <div class="relative">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" id="searchInput" placeholder="Cari barang..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full sm:w-64">
                        </div>
                        <button id="addItemBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition duration-200 flex items-center justify-center">
                            <i class="fas fa-plus mr-2"></i>Tambah Barang
                        </button>
                    </div>
                </div>
            </div>

            <!-- Items Table -->
            <div class="bg-white rounded-xl card-shadow overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Barang</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kategori</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Harga</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stok</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="itemsTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Items will be populated here -->
                        </tbody>
                    </table>
                </div>
                <div id="emptyState" class="text-center py-12">
                    <i class="fas fa-box-open text-gray-300 text-6xl mb-4"></i>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Belum ada barang</h3>
                    <p class="text-gray-500 mb-4">Mulai dengan menambahkan barang pertama Anda Dengan Menekan Tombol Tambah Barang Diatas</p>
                    
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Item Modal -->
    <div id="itemModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl card-shadow w-full max-w-md animate-fade-in">
            <div class="p-6 border-b">
                <h3 id="modalTitle" class="text-xl font-bold text-gray-800">Tambah Barang</h3>
            </div>
            
            <form id="itemForm" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Kode Barang</label>
                    <input type="text" id="itemCode" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Contoh: BRG001" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Barang</label>
                    <input type="text" id="itemName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan nama barang" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Kategori</label>
                    <select id="itemCategory" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        <option value="">Pilih kategori</option>
                        <option value="Makanan">Makanan</option>
                        <option value="Minuman">Minuman</option>
                        <option value="Snack">Snack</option>
                        <option value="Peralatan">Peralatan</option>
                        <option value="Lainnya">Lainnya</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Harga (Rp)</label>
                    <input type="number" id="itemPrice" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" min="0" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Stok</label>
                    <input type="number" id="itemStock" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" min="0" required>
                </div>
            </form>
            
            <div class="p-6 border-t flex space-x-3">
                <button id="cancelBtn" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 py-3 rounded-lg transition duration-200">Batal</button>
                <button id="saveBtn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition duration-200">Simpan</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration - GANTI DENGAN KONFIGURASI FIREBASE ANDA
        const firebaseConfig = {
            apiKey: "AIzaSyCtUYP9gjv6dX6RDJTAPUakA7s4QFy1M-k",
            authDomain: "aplikasikiossederhana.firebaseapp.com",
            databaseURL: "https://aplikasikiossederhana-default-rtdb.firebaseio.com/",
            projectId: "aplikasikiossederhana",
            storageBucket: "aplikasikiossederhana.firebasestorage.app",
            messagingSenderId: "732191928085",
            appId: "1:732191928085:web:ea9c0e057b122143f9031c"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const itemsRef = database.ref('items');

        // Application State
        let items = [];
        let editingIndex = -1;
        let isLoggedIn = localStorage.getItem('kiosLoggedIn') === 'true';

        // DOM Elements
        const loginPage = document.getElementById('loginPage');
        const dashboard = document.getElementById('dashboard');
        const loginForm = document.getElementById('loginForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const itemModal = document.getElementById('itemModal');
        const itemForm = document.getElementById('itemForm');
        const addItemBtn = document.getElementById('addItemBtn');
        const searchInput = document.getElementById('searchInput');

        // Firebase Functions
        function loadItemsFromFirebase() {
            itemsRef.on('value', (snapshot) => {
                const data = snapshot.val();
                items = data ? Object.keys(data).map(key => ({...data[key], firebaseKey: key})) : [];
                renderItems();
                updateStats();
            });
        }

        function saveItemToFirebase(item) {
            if (item.firebaseKey) {
                // Update existing item
                itemsRef.child(item.firebaseKey).set({
                    code: item.code,
                    name: item.name,
                    category: item.category,
                    price: item.price,
                    stock: item.stock,
                    createdAt: item.createdAt || new Date().toISOString()
                });
            } else {
                // Add new item
                itemsRef.push({
                    code: item.code,
                    name: item.name,
                    category: item.category,
                    price: item.price,
                    stock: item.stock,
                    createdAt: new Date().toISOString()
                });
            }
        }

        function deleteItemFromFirebase(firebaseKey) {
            itemsRef.child(firebaseKey).remove();
        }

        // Initialize App
        function init() {
            if (isLoggedIn) {
                showDashboard();
                loadItemsFromFirebase();
            } else {
                showLogin();
            }
        }

        // Login Functions
        function showLogin() {
            loginPage.classList.remove('hidden');
            dashboard.classList.add('hidden');
        }

        function showDashboard() {
            loginPage.classList.add('hidden');
            dashboard.classList.remove('hidden');
            renderItems();
            updateStats();
        }

        // Login Form Handler
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username === 'admin' && password === 'admin123') {
                localStorage.setItem('kiosLoggedIn', 'true');
                isLoggedIn = true;
                showDashboard();
            } else {
                alert('Username atau password salah!');
            }
        });

        // Logout Handler
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('kiosLoggedIn');
            isLoggedIn = false;
            showLogin();
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        });

        // Modal Functions
        function openModal(title = 'Tambah Barang', index = -1) {
            document.getElementById('modalTitle').textContent = title;
            editingIndex = index;
            
            if (index >= 0) {
                const item = items[index];
                document.getElementById('itemCode').value = item.code;
                document.getElementById('itemName').value = item.name;
                document.getElementById('itemCategory').value = item.category;
                document.getElementById('itemPrice').value = item.price;
                document.getElementById('itemStock').value = item.stock;
            } else {
                itemForm.reset();
            }
            
            itemModal.classList.remove('hidden');
        }

        function closeModal() {
            itemModal.classList.add('hidden');
            editingIndex = -1;
        }

        // Event Listeners
        addItemBtn.addEventListener('click', () => openModal());
        document.getElementById('cancelBtn').addEventListener('click', closeModal);
        
        // Save Item
        document.getElementById('saveBtn').addEventListener('click', () => {
            const code = document.getElementById('itemCode').value;
            const name = document.getElementById('itemName').value;
            const category = document.getElementById('itemCategory').value;
            const price = parseInt(document.getElementById('itemPrice').value);
            const stock = parseInt(document.getElementById('itemStock').value);

            if (!code || !name || !category || price < 0 || stock < 0) {
                alert('Mohon lengkapi semua field dengan benar!');
                return;
            }

            // Check for duplicate code (except when editing)
            const duplicateIndex = items.findIndex(item => item.code === code);
            if (duplicateIndex >= 0 && duplicateIndex !== editingIndex) {
                alert('Kode barang sudah ada!');
                return;
            }

            const item = { code, name, category, price, stock };

            if (editingIndex >= 0) {
                // Update existing item
                item.firebaseKey = items[editingIndex].firebaseKey;
                item.createdAt = items[editingIndex].createdAt;
            }

            // Save to Firebase instead of localStorage
            saveItemToFirebase(item);
            closeModal();
        });

        // Render Items
        function renderItems(filteredItems = items) {
            const tbody = document.getElementById('itemsTableBody');
            const emptyState = document.getElementById('emptyState');

            if (filteredItems.length === 0) {
                tbody.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            
            tbody.innerHTML = filteredItems.map((item, index) => {
                const originalIndex = items.indexOf(item);
                const stockStatus = item.stock <= 5 ? 'Menipis' : 'Tersedia';
                const stockClass = item.stock <= 5 ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800';
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.code}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.category}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Rp ${item.price.toLocaleString('id-ID')}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.stock}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-medium rounded-full ${stockClass}">${stockStatus}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm space-x-2">
                            <button onclick="openModal('Edit Barang', ${originalIndex})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs transition duration-200">
                                <i class="fas fa-edit mr-1"></i>Edit
                            </button>
                            <button onclick="deleteItem(${originalIndex})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-200">
                                <i class="fas fa-trash mr-1"></i>Hapus
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Delete Item
        function deleteItem(index) {
            if (confirm('Apakah Anda yakin ingin menghapus barang ini?')) {
                const item = items[index];
                if (item.firebaseKey) {
                    deleteItemFromFirebase(item.firebaseKey);
                }
            }
        }

        // Update Statistics
        function updateStats() {
            const totalItems = items.length;
            const availableStock = items.reduce((sum, item) => sum + item.stock, 0);
            const lowStock = items.filter(item => item.stock <= 5).length;

            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('availableStock').textContent = availableStock;
            document.getElementById('lowStock').textContent = lowStock;
        }

        // Search Functionality
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredItems = items.filter(item => 
                item.name.toLowerCase().includes(searchTerm) ||
                item.code.toLowerCase().includes(searchTerm) ||
                item.category.toLowerCase().includes(searchTerm)
            );
            renderItems(filteredItems);
        });

        // Close modal when clicking outside
        itemModal.addEventListener('click', (e) => {
            if (e.target === itemModal) {
                closeModal();
            }
        });

        // Initialize the application
        init();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9711cae15576ce8b',t:'MTc1NTUyNDEwNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
